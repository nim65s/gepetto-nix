From 00f8f3e69a7085147fbc8de5b1feb7b8d7448a9b Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:28:54 +0100
Subject: [PATCH 1/8] python3Packages.coal: make standalone optional

---
 pkgs/development/python-modules/coal/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/coal/default.nix b/pkgs/development/python-modules/coal/default.nix
index 773de813e0dac7ab41bc3749d6f5ca18ac4ef7a6..28a7e1642d4f8bd213bfbe77993c8ea06105ff55 100644
--- a/pkgs/development/python-modules/coal/default.nix
+++ b/pkgs/development/python-modules/coal/default.nix
@@ -10,6 +10,8 @@
   eigenpy,
   pylatexenc,
   numpy,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   coal.overrideAttrs (super: {
@@ -17,7 +19,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     # those are used by CMake at configure/build time
@@ -26,11 +28,12 @@ toPythonModule (
       pylatexenc
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
+    propagatedBuildInputs = [
       boost
-      coal
       eigenpy
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone coal;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From 59b3a7cfb7bc146577fa1d977d82d161dde4ba46 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:08 +0100
Subject: [PATCH 2/8] python3Packages.pinocchio: make standalone optional

---
 pkgs/development/python-modules/pinocchio/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/pinocchio/default.nix b/pkgs/development/python-modules/pinocchio/default.nix
index d2f722d9ee5c6c8cc4e13f669a97ec064ac922ad..95bda9dc0959a4a0c86fe872a6aea63eafd12208 100644
--- a/pkgs/development/python-modules/pinocchio/default.nix
+++ b/pkgs/development/python-modules/pinocchio/default.nix
@@ -10,6 +10,8 @@
   casadi,
   matplotlib,
   python,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   pinocchio.overrideAttrs (super: {
@@ -17,18 +19,19 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     nativeBuildInputs = super.nativeBuildInputs ++ [
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
+    propagatedBuildInputs = [
       casadi
       coal
-      pinocchio
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone pinocchio;
 
     checkInputs = super.checkInputs ++ [
       matplotlib

From f1eb62a226538fef187826c8d9fb90b13da2200d Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:24 +0100
Subject: [PATCH 3/8] python3Packages.example-robot-data: make standalone
 optional

---
 .../python-modules/example-robot-data/default.nix     | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/example-robot-data/default.nix b/pkgs/development/python-modules/example-robot-data/default.nix
index 3a9bfc18b39dff3bdf6008b0ab3ca20b521980dc..fe452c73b4395e64266e2cc760424fea0e417d58 100644
--- a/pkgs/development/python-modules/example-robot-data/default.nix
+++ b/pkgs/development/python-modules/example-robot-data/default.nix
@@ -8,6 +8,8 @@
 
   python,
   pinocchio,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   example-robot-data.overrideAttrs (super: {
@@ -15,17 +17,18 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     nativeBuildInputs = super.nativeBuildInputs ++ [
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
-      example-robot-data
+    propagatedBuildInputs = [
       pinocchio
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone example-robot-data;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From cf32a6f3742eb4954e008f6b89ab78d523be6d36 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:44 +0100
Subject: [PATCH 4/8] python3Packages.ndcurves: make standalone optional

---
 pkgs/development/python-modules/ndcurves/default.nix | 10 +++++++---
 1 file changed, 7 insertions(+), 3 deletions(-)

diff --git a/pkgs/development/python-modules/ndcurves/default.nix b/pkgs/development/python-modules/ndcurves/default.nix
index 885cfa64a0245c4c186681286249b9cd43c2cf7a..f04d1a11081595ee2282c10cbb2f62de6385154b 100644
--- a/pkgs/development/python-modules/ndcurves/default.nix
+++ b/pkgs/development/python-modules/ndcurves/default.nix
@@ -9,13 +9,15 @@
   boost,
   pinocchio,
   python,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   ndcurves.overrideAttrs (super: {
     pname = "py-${super.pname}";
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
     # those are used by CMake at configure/build time
     nativeBuildInputs = super.nativeBuildInputs ++ [
@@ -24,12 +26,14 @@ toPythonModule (
     propagatedBuildInputs = [
       boost
       pinocchio
-      ndcurves
     ]
-    ++ super.propagatedBuildInputs;
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone ndcurves;
+
     nativeCheckInputs = [
       pythonImportsCheckHook
     ];
+
     pythonImportsCheck = [
       "ndcurves"
     ];

From f585895ab90a403c367e5d1ff1b96fca76145399 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:29:53 +0100
Subject: [PATCH 5/8] python3Packages.tsid: make standalone optional

---
 pkgs/development/python-modules/tsid/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/tsid/default.nix b/pkgs/development/python-modules/tsid/default.nix
index 3894c80d28540eabcb1d9fda52190b4bbccaa8be..7fbf21fba188828f64da06907e84567c494aa5b0 100644
--- a/pkgs/development/python-modules/tsid/default.nix
+++ b/pkgs/development/python-modules/tsid/default.nix
@@ -8,6 +8,8 @@
 
   pinocchio,
   python,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   tsid.overrideAttrs (super: {
@@ -15,7 +17,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     # those are used by CMake at configure/build time
@@ -23,10 +25,11 @@ toPythonModule (
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
+    propagatedBuildInputs = [
       pinocchio
-      tsid
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone tsid;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From 0719964b5af5380d183280cf7aa9d54f6cc83f90 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:30:03 +0100
Subject: [PATCH 6/8] python3Packages.crocoddyl: make standalone optional

---
 pkgs/development/python-modules/crocoddyl/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/crocoddyl/default.nix b/pkgs/development/python-modules/crocoddyl/default.nix
index 5e5e449899f021098ff990967230ef9d449e0168..0ab83be96bc95675b78c3249c34ec3575399a4bc 100644
--- a/pkgs/development/python-modules/crocoddyl/default.nix
+++ b/pkgs/development/python-modules/crocoddyl/default.nix
@@ -14,6 +14,8 @@
   ipykernel,
   python,
   scipy,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   crocoddyl.overrideAttrs (super: {
@@ -21,7 +23,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     # those are used by CMake at configure/build time
@@ -29,10 +31,11 @@ toPythonModule (
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
-      crocoddyl
+    propagatedBuildInputs = [
       example-robot-data
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone crocoddyl;
 
     nativeCheckInputs = [
       ffmpeg

From 458fade3bdea6c1d30cbb55823861a529578e95a Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Wed, 29 Oct 2025 08:30:14 +0100
Subject: [PATCH 7/8] python3Packages.aligator: make standalone optional

---
 pkgs/development/python-modules/aligator/default.nix | 11 +++++++----
 1 file changed, 7 insertions(+), 4 deletions(-)

diff --git a/pkgs/development/python-modules/aligator/default.nix b/pkgs/development/python-modules/aligator/default.nix
index 6ef954f53a0ee4bbf6d367ccaeed5cf24f2d0ae2..e6e95ac5ba7165008a2349c975b3ec48d79bddfa 100644
--- a/pkgs/development/python-modules/aligator/default.nix
+++ b/pkgs/development/python-modules/aligator/default.nix
@@ -12,6 +12,8 @@
   python,
   matplotlib,
   pytest,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   aligator.overrideAttrs (super: {
@@ -19,7 +21,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     # this is used by CMake at configure/build time
@@ -27,11 +29,12 @@ toPythonModule (
       python
     ];
 
-    propagatedBuildInputs = super.propagatedBuildInputs ++ [
-      aligator
+    propagatedBuildInputs = [
       crocoddyl
       pinocchio
-    ];
+    ]
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone aligator;
 
     nativeCheckInputs = [
       pythonImportsCheckHook

From 2b60613f8763ede13a1cff2ff533e8afe123f6dc Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Mon, 10 Nov 2025 17:14:19 +0100
Subject: [PATCH 8/8] python3Packages.mim-solvers: make standalone optional

---
 pkgs/development/python-modules/mim-solvers/default.nix | 8 +++++---
 1 file changed, 5 insertions(+), 3 deletions(-)

diff --git a/pkgs/development/python-modules/mim-solvers/default.nix b/pkgs/development/python-modules/mim-solvers/default.nix
index ebb18af22dfdcfa6ffcb4bef231c4c58d80e56c8..ca90458c44762cb6ea90ccc1bf0a6c905d7c0b08 100644
--- a/pkgs/development/python-modules/mim-solvers/default.nix
+++ b/pkgs/development/python-modules/mim-solvers/default.nix
@@ -19,6 +19,8 @@
 
   # nativeCheckInputs
   pytest,
+
+  buildStandalone ? true,
 }:
 toPythonModule (
   mim-solvers.overrideAttrs (super: {
@@ -26,7 +28,7 @@ toPythonModule (
 
     cmakeFlags = super.cmakeFlags ++ [
       (lib.cmakeBool "BUILD_PYTHON_INTERFACE" true)
-      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" true)
+      (lib.cmakeBool "BUILD_STANDALONE_PYTHON_INTERFACE" buildStandalone)
     ];
 
     # this is used by CMake at configure/build time
@@ -38,12 +40,12 @@ toPythonModule (
       boost
       crocoddyl
       eigenpy
-      mim-solvers
       osqp
       proxsuite
       scipy
     ]
-    ++ super.propagatedBuildInputs;
+    ++ super.propagatedBuildInputs
+    ++ lib.optional buildStandalone mim-solvers;
 
     nativeCheckInputs = super.nativeCheckInputs ++ [
       pythonImportsCheckHook
