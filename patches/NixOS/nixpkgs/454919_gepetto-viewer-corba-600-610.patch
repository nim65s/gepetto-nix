From 544e3e3954a74c71b7e3853801ea19e9f82b5dfd Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Thu, 23 Oct 2025 15:49:45 +0200
Subject: [PATCH 1/4] gepetto-viewer: 6.0.0 -> 6.1.0

Diff: https://github.com/gepetto/gepetto-viewer/compare/v6.0.0...v6.1.0
---
 pkgs/by-name/ge/gepetto-viewer/package.nix | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/pkgs/by-name/ge/gepetto-viewer/package.nix b/pkgs/by-name/ge/gepetto-viewer/package.nix
index ed7eb146f06f7a527639db6709a289ff8290507e..1cdb2f9834daf3f01d9501a77c1f90586826f4ab 100644
--- a/pkgs/by-name/ge/gepetto-viewer/package.nix
+++ b/pkgs/by-name/ge/gepetto-viewer/package.nix
@@ -20,13 +20,13 @@
 let
   gepetto-viewer = stdenv.mkDerivation (finalAttrs: {
     pname = "gepetto-viewer";
-    version = "6.0.0";
+    version = "6.1.0";
 
     src = fetchFromGitHub {
       owner = "gepetto";
       repo = "gepetto-viewer";
       rev = "v${finalAttrs.version}";
-      hash = "sha256-nbA+JNogtlktkByUD2Urx3kJpe/8jgIjO59XXOAPpNs=";
+      hash = "sha256-wEwGRTNx9t/bQE8APLFvldwMkx4R/2eoIolAxkJR2dw=";
     };
 
     cmakeFlags = [

From e5301ef0dec0d5c55f0c2583ad04b7e9ea3e62b3 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Thu, 23 Oct 2025 15:49:51 +0200
Subject: [PATCH 2/4] gepetto-viewer-corba: 6.0.0 -> 6.1.0

Diff: https://github.com/gepetto/gepetto-viewer-corba/compare/v6.0.0...v6.1.0
---
 pkgs/by-name/ge/gepetto-viewer-corba/package.nix | 4 ++--
 1 file changed, 2 insertions(+), 2 deletions(-)

diff --git a/pkgs/by-name/ge/gepetto-viewer-corba/package.nix b/pkgs/by-name/ge/gepetto-viewer-corba/package.nix
index 89b8d003812317b27287c68f6dc452f40326a453..c941bb97311e66815ed28035f2a3dbb4727d3f73 100644
--- a/pkgs/by-name/ge/gepetto-viewer-corba/package.nix
+++ b/pkgs/by-name/ge/gepetto-viewer-corba/package.nix
@@ -14,13 +14,13 @@
 
 stdenv.mkDerivation (finalAttrs: {
   pname = "gepetto-viewer-corba";
-  version = "6.0.0";
+  version = "6.1.0";
 
   src = fetchFromGitHub {
     owner = "gepetto";
     repo = "gepetto-viewer-corba";
     rev = "v${finalAttrs.version}";
-    hash = "sha256-+rt6eDlNk3CEC5AsOBJgFEAIqKnM7wxRofyd44H6TUw=";
+    hash = "sha256-T/lpxELvQwSb4gVrzjL934QfdHWeAezbnF4Dp58c/vI=";
   };
 
   outputs = [

From 35782b4304c10b0f55b320724e568f7ca2e319c5 Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Thu, 23 Oct 2025 15:54:46 +0200
Subject: [PATCH 3/4] gepetto-viewer: use finalPackage

---
 pkgs/by-name/ge/gepetto-viewer/package.nix | 185 ++++++++++-----------
 1 file changed, 91 insertions(+), 94 deletions(-)

diff --git a/pkgs/by-name/ge/gepetto-viewer/package.nix b/pkgs/by-name/ge/gepetto-viewer/package.nix
index 1cdb2f9834daf3f01d9501a77c1f90586826f4ab..2aec1cd3b7520bb4a4f9929949af8562483a8e6d 100644
--- a/pkgs/by-name/ge/gepetto-viewer/package.nix
+++ b/pkgs/by-name/ge/gepetto-viewer/package.nix
@@ -17,111 +17,108 @@
   stdenv,
   runCommand,
 }:
-let
-  gepetto-viewer = stdenv.mkDerivation (finalAttrs: {
-    pname = "gepetto-viewer";
-    version = "6.1.0";
+stdenv.mkDerivation (finalAttrs: {
+  pname = "gepetto-viewer";
+  version = "6.1.0";
 
-    src = fetchFromGitHub {
-      owner = "gepetto";
-      repo = "gepetto-viewer";
-      rev = "v${finalAttrs.version}";
-      hash = "sha256-wEwGRTNx9t/bQE8APLFvldwMkx4R/2eoIolAxkJR2dw=";
-    };
+  src = fetchFromGitHub {
+    owner = "gepetto";
+    repo = "gepetto-viewer";
+    rev = "v${finalAttrs.version}";
+    hash = "sha256-wEwGRTNx9t/bQE8APLFvldwMkx4R/2eoIolAxkJR2dw=";
+  };
 
-    cmakeFlags = [
-      (lib.cmakeBool "BUILD_PY_QCUSTOM_PLOT" (!stdenv.hostPlatform.isDarwin))
-      (lib.cmakeBool "BUILD_PY_QGV" (!stdenv.hostPlatform.isDarwin))
-    ];
+  cmakeFlags = [
+    (lib.cmakeBool "BUILD_PY_QCUSTOM_PLOT" (!stdenv.hostPlatform.isDarwin))
+    (lib.cmakeBool "BUILD_PY_QGV" (!stdenv.hostPlatform.isDarwin))
+  ];
 
-    outputs = [
-      "out"
-      "dev"
-      "bin"
-      "doc"
-    ];
+  outputs = [
+    "out"
+    "dev"
+    "bin"
+    "doc"
+  ];
 
-    buildInputs = [
-      python3Packages.boost
-      python3Packages.python-qt
-      libsForQt5.qtbase
-    ];
+  buildInputs = [
+    python3Packages.boost
+    python3Packages.python-qt
+    libsForQt5.qtbase
+  ];
 
-    nativeBuildInputs = [
-      cmake
-      doxygen
-      libsForQt5.wrapQtAppsHook
-      pkg-config
-      python3Packages.python
-    ]
-    ++ lib.optionals (stdenv.hostPlatform.isDarwin && stdenv.hostPlatform.isAarch64) [
-      darwin.autoSignDarwinBinariesHook
-    ];
+  nativeBuildInputs = [
+    cmake
+    doxygen
+    libsForQt5.wrapQtAppsHook
+    pkg-config
+    python3Packages.python
+  ]
+  ++ lib.optionals (stdenv.hostPlatform.isDarwin && stdenv.hostPlatform.isAarch64) [
+    darwin.autoSignDarwinBinariesHook
+  ];
 
-    propagatedBuildInputs = [
-      jrl-cmakemodules
-      openscenegraph
-      osgqt
-      qgv
-    ];
+  propagatedBuildInputs = [
+    jrl-cmakemodules
+    openscenegraph
+    osgqt
+    qgv
+  ];
 
-    doCheck = true;
+  doCheck = true;
 
-    # wrapQtAppsHook uses isMachO, which fails to detect binaries without this
-    # ref. https://github.com/NixOS/nixpkgs/pull/138334
-    preFixup = lib.optionalString stdenv.hostPlatform.isDarwin "export LC_ALL=C";
+  # wrapQtAppsHook uses isMachO, which fails to detect binaries without this
+  # ref. https://github.com/NixOS/nixpkgs/pull/138334
+  preFixup = lib.optionalString stdenv.hostPlatform.isDarwin "export LC_ALL=C";
 
-    postFixup = ''
-      # CMake is not aware exports are in $dev
-      substituteInPlace $dev/lib/cmake/gepetto-viewer/gepetto-viewerConfig.cmake --replace-fail \
-        "$out/lib/cmake" \
-        "$dev/lib/cmake"
+  postFixup = ''
+    # CMake is not aware exports are in $dev
+    substituteInPlace $dev/lib/cmake/gepetto-viewer/gepetto-viewerConfig.cmake --replace-fail \
+      "$out/lib/cmake" \
+      "$dev/lib/cmake"
 
-      # wrapQtAppsHook does only wrap stuff in $out, we want $bin
-      echo wrapping $bin/bin/gepetto-gui
-      wrapQtApp $bin/bin/gepetto-gui
-    '';
+    # wrapQtAppsHook does only wrap stuff in $out, we want $bin
+    echo wrapping $bin/bin/gepetto-gui
+    wrapQtApp $bin/bin/gepetto-gui
+  '';
 
-    # Fontconfig error: Cannot load default config file: No such file: (null)
-    env.FONTCONFIG_FILE = "${fontconfig.out}/etc/fonts/fonts.conf";
+  # Fontconfig error: Cannot load default config file: No such file: (null)
+  env.FONTCONFIG_FILE = "${fontconfig.out}/etc/fonts/fonts.conf";
 
-    # Fontconfig error: No writable cache directories
-    preBuild = "export XDG_CACHE_HOME=$(mktemp -d)";
+  # Fontconfig error: No writable cache directories
+  preBuild = "export XDG_CACHE_HOME=$(mktemp -d)";
 
-    passthru.withPlugins =
-      plugins:
-      runCommand "gepetto-gui"
-        {
-          inherit (finalAttrs) version;
-          pname = "gepetto-gui";
-          meta = {
-            # can't just "inherit (gepetto-viewer) meta;" because:
-            # error: derivation '/nix/store/…-gepetto-gui.drv' does not have wanted outputs 'bin'
-            inherit (gepetto-viewer.meta)
-              description
-              homepage
-              license
-              maintainers
-              mainProgram
-              platforms
-              ;
-          };
-          nativeBuildInputs = [ makeWrapper ];
-          propagatedBuildInputs = plugins;
-        }
-        ''
-          makeWrapper ${lib.getExe gepetto-viewer} $out/bin/gepetto-gui \
-            --set GEPETTO_GUI_PLUGIN_DIRS ${lib.makeLibraryPath plugins}
-        '';
+  passthru.withPlugins =
+    plugins:
+    runCommand "gepetto-gui"
+      {
+        inherit (finalAttrs) version;
+        pname = "gepetto-gui";
+        meta = {
+          # can't just "inherit (gepetto-viewer) meta;" because:
+          # error: derivation '/nix/store/…-gepetto-gui.drv' does not have wanted outputs 'bin'
+          inherit (finalAttrs.finalPackage.meta)
+            description
+            homepage
+            license
+            maintainers
+            mainProgram
+            platforms
+            ;
+        };
+        nativeBuildInputs = [ makeWrapper ];
+        propagatedBuildInputs = plugins;
+      }
+      ''
+        makeWrapper ${lib.getExe finalAttrs.finalPackage} $out/bin/gepetto-gui \
+          --set GEPETTO_GUI_PLUGIN_DIRS ${lib.makeLibraryPath plugins}
+      '';
 
-    meta = {
-      description = "Graphical Interface for Pinocchio and HPP";
-      homepage = "https://github.com/gepetto/gepetto-viewer";
-      license = lib.licenses.lgpl3Only;
-      maintainers = [ lib.maintainers.nim65s ];
-      mainProgram = "gepetto-gui";
-      platforms = lib.platforms.unix;
-    };
-  });
-in
-gepetto-viewer
+  meta = {
+    description = "Graphical Interface for Pinocchio and HPP";
+    homepage = "https://github.com/gepetto/gepetto-viewer";
+    license = lib.licenses.lgpl3Only;
+    maintainers = [ lib.maintainers.nim65s ];
+    mainProgram = "gepetto-gui";
+    platforms = lib.platforms.unix;
+  };
+})

From 6fc2e5d5b123cb9813d2481f33825f07ea82c92d Mon Sep 17 00:00:00 2001
From: Guilhem Saurel <guilhem.saurel@laas.fr>
Date: Thu, 23 Oct 2025 15:55:23 +0200
Subject: [PATCH 4/4] gepetto-viewer-corba: clean

---
 pkgs/by-name/ge/gepetto-viewer-corba/package.nix | 2 --
 1 file changed, 2 deletions(-)

diff --git a/pkgs/by-name/ge/gepetto-viewer-corba/package.nix b/pkgs/by-name/ge/gepetto-viewer-corba/package.nix
index c941bb97311e66815ed28035f2a3dbb4727d3f73..b73f391448850530432f8b73ee5729b528f4e73d 100644
--- a/pkgs/by-name/ge/gepetto-viewer-corba/package.nix
+++ b/pkgs/by-name/ge/gepetto-viewer-corba/package.nix
@@ -1,10 +1,8 @@
 {
-  boost,
   cmake,
   doxygen,
   fetchFromGitHub,
   fontconfig,
-  gepetto-viewer,
   lib,
   pkg-config,
   python3Packages,
